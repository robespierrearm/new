# Миграция: Добавление номера гос закупки

## Описание изменений

Добавлено новое поле **"Номер гос закупки"** (`purchase_number`) в карточки тендеров.

### Новый функционал:

1. **Номер гос закупки** - отображается в раскрывающейся части карточки тендера
2. **Автоматический расчёт снижения** - показывает разницу между начальной ценой и ценой подачи:
   - В рублях
   - В процентах

## Инструкция по применению

### 1. Обновить базу данных Supabase

Выполните SQL-скрипт в **Supabase SQL Editor**:

```sql
-- Откройте файл: supabase/add_purchase_number.sql
-- Или выполните команду ниже:

ALTER TABLE public.tenders 
ADD COLUMN IF NOT EXISTS purchase_number TEXT;

COMMENT ON COLUMN public.tenders.purchase_number IS 'Номер государственной закупки';

CREATE INDEX IF NOT EXISTS idx_tenders_purchase_number ON public.tenders(purchase_number);
```

### 2. Перезапустить приложение

После применения миграции перезапустите dev-сервер:

```bash
npm run dev
```

## Что изменилось

### Файлы:

- ✅ `lib/supabase.ts` - добавлено поле `purchase_number` в тип `Tender`
- ✅ `components/TenderCardExpanded.tsx` - добавлено отображение номера и расчёт снижения
- ✅ `components/AddTenderDialog.tsx` - добавлено поле ввода номера гос закупки
- ✅ `components/EditTenderDialog.tsx` - добавлено поле редактирования номера
- ✅ `app/(dashboard)/tenders/page.tsx` - обновлена обработка добавления тендера
- ✅ `supabase/add_purchase_number.sql` - SQL миграция для БД

## Использование

1. При создании/редактировании тендера заполните поле **"Номер гос закупки"**
2. Укажите **начальную цену** и **цену подачи**
3. При открытии карточки тендера вы увидите:
   - Номер гос закупки (если указан)
   - Снижение цены в рублях и процентах (если указаны обе цены)

## Пример отображения

```
┌─────────────────────────────────────┐
│ # Номер гос закупки                 │
│ № 0123456789012345678901            │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│ ↓ Снижение цены                     │
│ 150 000 ₽ (15.00%)                  │
└─────────────────────────────────────┘
```
