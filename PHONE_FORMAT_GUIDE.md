# Руководство по форматированию телефонных номеров

## Обзор

Система автоматически форматирует телефонные номера при добавлении и редактировании поставщиков.

## Поддерживаемые форматы

### 1. Мобильные номера (Россия)
**Условие**: Номер начинается с `8` или `+7`  
**Формат**: `+7 (XXX) XXX-XX-XX`

**Примеры**:
- Ввод: `89991234567` → Отображение: `+7 (999) 123-45-67`
- Ввод: `79991234567` → Отображение: `+7 (999) 123-45-67`
- Ввод: `+79991234567` → Отображение: `+7 (999) 123-45-67`

### 2. Городские номера
**Условие**: Номер начинается с `3`, `4`, `5` или `6`  
**Формат**: `(XXX) XX-XX-XX`

**Примеры**:
- Ввод: `4951234567` → Отображение: `(495) 12-34-56`
- Ввод: `3812345678` → Отображение: `(381) 23-45-67`

### 3. Нестандартные номера
**Условие**: Любой другой формат (международные, короткие номера и т.д.)  
**Формат**: Сохраняется и отображается как есть

**Примеры**:
- Ввод: `+1-555-123-4567` → Отображение: `+1-555-123-4567`
- Ввод: `112` → Отображение: `112`
- Ввод: `+44 20 7946 0958` → Отображение: `+44 20 7946 0958`

## Как это работает

### При вводе номера
1. Система автоматически определяет тип номера по первым цифрам
2. Применяется соответствующая маска ввода
3. Справа от поля отображается тип номера: "Мобильный", "Городской" или "Произвольный"

### При сохранении
- Мобильные и городские номера сохраняются в отформатированном виде
- Нестандартные номера сохраняются в том виде, как были введены

### В таблице поставщиков
- Все номера отображаются в отформатированном виде
- Используется моноширинный шрифт для лучшей читаемости
- Нераспознанные форматы отображаются как есть

## Валидация

### Мобильные номера
Регулярное выражение: `^\+7\s\(\d{3}\)\s\d{3}-\d{2}-\d{2}$`

### Городские номера
Регулярное выражение: `^\(\d{3}\)\s\d{2}-\d{2}-\d{2}$`

### Нестандартные номера
Проверяется наличие хотя бы одной цифры

## Технические детали

### Используемые библиотеки
- `react-input-mask` - для автоматического форматирования при вводе
- Кастомные утилиты в `lib/phoneUtils.ts`

### Компоненты
- `PhoneInput` - компонент ввода телефона с автоформатированием
- `AddSupplierDialog` - диалог добавления поставщика
- `EditSupplierDialog` - диалог редактирования поставщика

### Утилиты (`lib/phoneUtils.ts`)
- `detectPhoneType()` - определяет тип номера
- `getPhoneMask()` - возвращает маску для типа
- `formatPhoneForDisplay()` - форматирует для отображения
- `validatePhone()` - валидирует номер
- `normalizePhoneForStorage()` - нормализует для сохранения
- `getPhonePlaceholder()` - возвращает placeholder

## Примеры использования

### В коде
```typescript
import { PhoneInput } from '@/components/PhoneInput';
import { formatPhoneForDisplay } from '@/lib/phoneUtils';

// Использование компонента
<PhoneInput
  value={phone}
  onChange={(value) => setPhone(value)}
/>

// Форматирование для отображения
const formatted = formatPhoneForDisplay('+79991234567');
// Результат: "+7 (999) 123-45-67"
```

## Особенности

1. **Автоопределение маски**: Маска меняется автоматически при вводе первых цифр
2. **Сохранение оригинала**: Нестандартные номера не изменяются
3. **Визуальная индикация**: Тип номера отображается справа от поля
4. **Гибкость**: Поддержка любых международных форматов

## Будущие улучшения

- [ ] Поддержка других стран (автоопределение по коду страны)
- [ ] Валидация длины номера
- [ ] Автоматическое добавление кода страны
- [ ] История форматов для быстрого выбора
