# üîê –ó–∞—â–∏—Ç–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ - TenderCRM

## ‚ú® –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

–ü–æ–ª–Ω–∞—è –∑–∞—â–∏—Ç–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü –ø—Ä–æ–µ–∫—Ç–∞ –æ—Ç –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.

### üõ°Ô∏è –°–∏—Å—Ç–µ–º–∞ –∑–∞—â–∏—Ç—ã:

#### **1. Middleware (—Å–µ—Ä–≤–µ—Ä–Ω–∞—è –∑–∞—â–∏—Ç–∞):**

**–§–∞–π–ª:** `middleware.ts`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç cookie `auth-token` –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
- ‚úÖ –ü—É–±–ª–∏—á–Ω—ã–µ –ø—É—Ç–∏: `/login`
- ‚úÖ –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—É—Ç–∏ - –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ
- ‚úÖ –ë–µ–∑ —Ç–æ–∫–µ–Ω–∞ ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login`
- ‚úÖ –° —Ç–æ–∫–µ–Ω–æ–º –Ω–∞ `/login` ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/dashboard`

**–ö–æ–¥:**
```typescript
export function middleware(request: NextRequest) {
  const path = request.nextUrl.pathname;
  const publicPaths = ['/login'];
  const isPublicPath = publicPaths.includes(path);
  const token = request.cookies.get('auth-token')?.value || '';

  // –ï—Å–ª–∏ –ø—É–±–ª–∏—á–Ω—ã–π –ø—É—Ç—å –∏ –µ—Å—Ç—å —Ç–æ–∫–µ–Ω ‚Üí –¥–∞—à–±–æ—Ä–¥
  if (isPublicPath && token) {
    return NextResponse.redirect(new URL('/dashboard', request.url));
  }

  // –ï—Å–ª–∏ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –ø—É—Ç—å –∏ –Ω–µ—Ç —Ç–æ–∫–µ–Ω–∞ ‚Üí –ª–æ–≥–∏–Ω
  if (!isPublicPath && !token) {
    return NextResponse.redirect(new URL('/login', request.url));
  }

  return NextResponse.next();
}
```

#### **2. AuthProvider (–∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –∑–∞—â–∏—Ç–∞):**

**–§–∞–π–ª:** `components/AuthProvider.tsx`

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç `localStorage` –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- ‚úÖ –î—É–±–ª–∏—Ä—É–µ—Ç –∑–∞—â–∏—Ç—É middleware
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç

**–ö–æ–¥:**
```typescript
export function AuthProvider({ children }) {
  const router = useRouter();
  const pathname = usePathname();

  useEffect(() => {
    const publicPaths = ['/login'];
    const isPublicPath = publicPaths.includes(pathname);
    const currentUser = localStorage.getItem('currentUser');

    // –ü—Ä–∏–≤–∞—Ç–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –±–µ–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ‚Üí –ª–æ–≥–∏–Ω
    if (!isPublicPath && !currentUser) {
      router.push('/login');
      return;
    }

    // –ü—É–±–ª–∏—á–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º ‚Üí –¥–∞—à–±–æ—Ä–¥
    if (isPublicPath && currentUser) {
      router.push('/dashboard');
      return;
    }
  }, [pathname, router]);

  return <>{children}</>;
}
```

#### **3. Cookie –ø—Ä–∏ –≤—Ö–æ–¥–µ:**

**–§–∞–π–ª:** `app/login/page.tsx`

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**
```typescript
// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º cookie –¥–ª—è middleware
document.cookie = `auth-token=${user.id}; path=/; max-age=86400`; // 24 —á–∞—Å–∞
```

**–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:** 24 —á–∞—Å–∞

#### **4. –£–¥–∞–ª–µ–Ω–∏–µ cookie –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ:**

**–§–∞–π–ª:** `components/AppSidebar.tsx`

**–ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:**
```typescript
// –£–¥–∞–ª—è–µ–º cookie
document.cookie = 'auth-token=; path=/; max-age=0';
```

#### **5. –£–±—Ä–∞–Ω—ã –ø—Ä–∏–º–µ—Ä—ã –ª–æ–≥–∏–Ω–∞/–ø–∞—Ä–æ–ª—è:**

**–ë—ã–ª–æ:**
```tsx
<Input placeholder="Armen@gmail.com" />
<Input placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
```

**–°—Ç–∞–ª–æ:**
```tsx
<Input placeholder="–í–≤–µ–¥–∏—Ç–µ email" />
<Input placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" />
```

### üîí –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞—â–∏—Ç–∞:

#### **–°—Ü–µ–Ω–∞—Ä–∏–π 1: –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç `/dashboard`
2. **Middleware** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç cookie ‚Üí –Ω–µ—Ç —Ç–æ–∫–µ–Ω–∞
3. **–†–µ–¥–∏—Ä–µ–∫—Ç** –Ω–∞ `/login`
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ñ–æ—Ä–º—É –≤—Ö–æ–¥–∞

#### **–°—Ü–µ–Ω–∞—Ä–∏–π 2: –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Ö–æ–¥–∏—Ç –≤ —Å–∏—Å—Ç–µ–º—É
2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è cookie `auth-token`
3. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `localStorage`
4. –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/dashboard`
5. **Middleware** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç cookie ‚Üí –µ—Å—Ç—å —Ç–æ–∫–µ–Ω
6. –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω

#### **–°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–∫—Ä—ã—Ç—å /login –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞**

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç `/login`
3. **Middleware** –ø—Ä–æ–≤–µ—Ä—è–µ—Ç cookie ‚Üí –µ—Å—Ç—å —Ç–æ–∫–µ–Ω
4. **–†–µ–¥–∏—Ä–µ–∫—Ç** –Ω–∞ `/dashboard`

#### **–°—Ü–µ–Ω–∞—Ä–∏–π 4: –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã**

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–í—ã—Ö–æ–¥"
2. –£–¥–∞–ª—è–µ—Ç—Å—è cookie
3. –û—á–∏—â–∞–µ—Ç—Å—è localStorage
4. –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login`
5. –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–∫—Ä—ã—Ç—å `/dashboard` ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login`

### üõ°Ô∏è –î–≤–æ–π–Ω–∞—è –∑–∞—â–∏—Ç–∞:

**–°–µ—Ä–≤–µ—Ä–Ω–∞—è (Middleware):**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
- ‚úÖ –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ–±–æ–π—Ç–∏
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–Ω–æ–º JS

**–ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è (AuthProvider):**
- ‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
- ‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞

### üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

**–°–æ–∑–¥–∞–Ω—ã:**
1. ‚úÖ `middleware.ts` - —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –∑–∞—â–∏—Ç–∞
2. ‚úÖ `components/AuthProvider.tsx` - –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –∑–∞—â–∏—Ç–∞

**–û–±–Ω–æ–≤–ª–µ–Ω—ã:**
3. ‚úÖ `app/layout.tsx` - –æ–±–µ—Ä–Ω—É—Ç –≤ AuthProvider
4. ‚úÖ `app/login/page.tsx` - —É—Å—Ç–∞–Ω–æ–≤–∫–∞ cookie, —É–±—Ä–∞–Ω—ã –ø—Ä–∏–º–µ—Ä—ã
5. ‚úÖ `components/AppSidebar.tsx` - —É–¥–∞–ª–µ–Ω–∏–µ cookie –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ

### üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

#### **–¢–µ—Å—Ç 1: –î–æ—Å—Ç—É–ø –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏**

1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –≤ —Ä–µ–∂–∏–º–µ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `http://localhost:3000/dashboard`
3. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login`
   - ‚úÖ –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω

#### **–¢–µ—Å—Ç 2: –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É**

1. –í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å
2. –ù–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏"
3. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - ‚úÖ Cookie —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
   - ‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/dashboard`
   - ‚úÖ –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω

#### **–¢–µ—Å—Ç 3: –ü–æ–ø—ã—Ç–∫–∞ –æ—Ç–∫—Ä—ã—Ç—å /login –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞**

1. –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å
2. –û—Ç–∫—Ä–æ–π—Ç–µ `/login` –≤—Ä—É—á–Ω—É—é
3. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/dashboard`

#### **–¢–µ—Å—Ç 4: –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã**

1. –ù–∞–∂–º–∏—Ç–µ "–í—ã—Ö–æ–¥"
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å `/dashboard`
3. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - ‚úÖ Cookie —É–¥–∞–ª–µ–Ω
   - ‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login`
   - ‚úÖ –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω

#### **–¢–µ—Å—Ç 5: –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ URL**

1. –í—ã–π–¥–∏—Ç–µ –∏–∑ —Å–∏—Å—Ç–µ–º—ã
2. –í—Å—Ç–∞–≤—å—Ç–µ –≤ –∞–¥—Ä–µ—Å–Ω—É—é —Å—Ç—Ä–æ–∫—É:
   - `/dashboard`
   - `/tenders`
   - `/accounting`
   - `/admin`
3. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - ‚úÖ –í—Å–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç—è—Ç –Ω–∞ `/login`

### üîë –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:

**Cookie:**
- –ò–º—è: `auth-token`
- –ó–Ω–∞—á–µ–Ω–∏–µ: `user.id`
- –ü—É—Ç—å: `/` (–≤–µ—Å—å —Å–∞–π—Ç)
- –°—Ä–æ–∫: 24 —á–∞—Å–∞
- HttpOnly: –Ω–µ—Ç (–Ω—É–∂–µ–Ω –¥–æ—Å—Ç—É–ø –∏–∑ JS)

**localStorage:**
- –ö–ª—é—á: `currentUser`
- –ó–Ω–∞—á–µ–Ω–∏–µ: JSON –æ–±—ä–µ–∫—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

**–ü—É–±–ª–∏—á–Ω—ã–µ –ø—É—Ç–∏:**
- `/login` - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—É–±–ª–∏—á–Ω—ã–π –ø—É—Ç—å
- –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ - –ø—Ä–∏–≤–∞—Ç–Ω–æ–µ

### ‚ö†Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:

**–ß—Ç–æ –∑–∞—â–∏—â–µ–Ω–æ:**
- ‚úÖ –í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–∞—à–±–æ—Ä–¥–∞
- ‚úÖ –ê–¥–º–∏–Ω–∫–∞
- ‚úÖ –ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è
- ‚úÖ –¢–µ–Ω–¥–µ—Ä—ã
- ‚úÖ –§–∞–π–ª—ã

**–ß—Ç–æ –ù–ï –∑–∞—â–∏—â–µ–Ω–æ:**
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–æ–≥–∏–Ω–∞ `/login`
- –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã (CSS, JS, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
- API routes (–µ—Å–ª–∏ –µ—Å—Ç—å)

### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:

**–î–ª—è production:**
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HttpOnly cookies
2. –î–æ–±–∞–≤—å—Ç–µ CSRF –∑–∞—â–∏—Ç—É
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ JWT —Ç–æ–∫–µ–Ω—ã
4. –î–æ–±–∞–≤—å—Ç–µ refresh tokens
5. –®–∏—Ñ—Ä—É–π—Ç–µ –ø–∞—Ä–æ–ª–∏ (bcrypt)

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚úÖ –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –¥–µ–º–æ/MVP
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –∏ –ø–æ–Ω—è—Ç–Ω–∞—è
- ‚ö†Ô∏è –ù–µ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

**–ì–æ—Ç–æ–≤–æ!** üéâ

–¢–µ–ø–µ—Ä—å –≤–µ—Å—å –ø—Ä–æ–µ–∫—Ç –∑–∞—â–∏—â–µ–Ω –æ—Ç –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞!
